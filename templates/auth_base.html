<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}CarHub{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    {% block extra_head %}{% endblock %}
</head>
<body class="theme-premium">
    <!-- Navigation Header -->
    <header class="main-header nav-premium">
        <div class="logo">
            <img src="{{ url_for('static', filename='logo.png') }}" alt="CarHub Logo">
        </div>
        <nav class="main-nav">
            <ul>
                <li><a href="{{ url_for('index') }}">Home</a></li>
                <li><a href="{{ url_for('cars') }}">Shop Cars</a></li>
                <li><a href="{{ url_for('inventory') }}">Inventory</a></li>
                <li><a href="{{ url_for('services') }}">Services</a></li>
                <li><a href="{{ url_for('video') }}">Video Gallery</a></li>
                <li><a href="{{ url_for('about') }}">About Us</a></li>
                {% if current_user.is_authenticated %}
                    <li class="profile-dropdown">
                        <div class="profile-trigger" onclick="toggleProfileDropdown()">
                            <div class="profile-info">
                                <div class="profile-avatar">
                                    <i class="fas fa-user-circle"></i>
                                </div>
                                <span class="profile-name">{{ current_user.username if current_user.username else 'User' }}</span>
                            </div>
                            <i class="fas fa-chevron-down dropdown-arrow"></i>
                        </div>
                        <div class="profile-dropdown-menu" id="profileDropdown">
                            <div class="dropdown-header">
                                <div class="dropdown-avatar">
                                    <i class="fas fa-user-circle"></i>
                                </div>
                                <div class="dropdown-user-info">
                                    <span class="dropdown-name">{{ current_user.username if current_user.username else 'User' }}</span>
                                    <span class="dropdown-email">{{ current_user.email if current_user.email else 'user@carhub.com' }}</span>
                                </div>
                            </div>
                            <div class="dropdown-divider"></div>
                            <div class="dropdown-menu-items">
                                <a href="{{ url_for('profile') }}" class="dropdown-item">
                                    <i class="fas fa-user"></i>
                                    <span>Profile</span>
                                </a>
                                <a href="{{ url_for('dashboard') }}" class="dropdown-item">
                                    <i class="fas fa-tachometer-alt"></i>
                                    <span>Dashboard</span>
                                </a>
                                <a href="{{ url_for('my_orders') }}" class="dropdown-item">
                                    <i class="fas fa-shopping-bag"></i>
                                    <span>My Orders</span>
                                </a>
                            </div>
                            <div class="dropdown-divider"></div>
                            <div class="dropdown-menu-items">
                                <a href="{{ url_for('logout') }}" class="dropdown-item logout-item">
                                    <i class="fas fa-sign-out-alt"></i>
                                    <span>Logout</span>
                                </a>
                            </div>
                        </div>
                    </li>
                {% else %}
                    <li><a href="{{ url_for('login') }}">Login</a></li>
                    <li><a href="{{ url_for('sign_up') }}">Sign Up</a></li>
                {% endif %}
            </ul>
        </nav>
    </header>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages">
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'danger' if category == 'error' else category }}">
                        {{ message }}
                        <button type="button" class="close" onclick="this.parentElement.style.display='none'">
                            <span>&times;</span>
                        </button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Main Content -->
    {% block content %}{% endblock %}

    <!-- Scripts -->
    <script>
        // Auto-hide flash messages after 5 seconds
        document.addEventListener('DOMContentLoaded', function() {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(function(alert) {
                setTimeout(function() {
                    alert.style.opacity = '0';
                    setTimeout(function() {
                        alert.style.display = 'none';
                    }, 300);
                }, 5000);
            });
        });

        // Header scroll effect
        window.addEventListener('scroll', function() {
            if (window.scrollY > 50) {
                document.body.classList.add('scrolled');
            } else {
                document.body.classList.remove('scrolled');
            }
        });

        // Profile dropdown functionality
        function toggleProfileDropdown() {
            const dropdown = document.getElementById('profileDropdown');
            const arrow = document.querySelector('.dropdown-arrow');
            
            if (dropdown.classList.contains('active')) {
                dropdown.classList.remove('active');
                arrow.style.transform = 'rotate(0deg)';
            } else {
                dropdown.classList.add('active');
                arrow.style.transform = 'rotate(180deg)';
            }
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('profileDropdown');
            const profileTrigger = document.querySelector('.profile-trigger');
            
            if (dropdown && !profileTrigger.contains(event.target) && !dropdown.contains(event.target)) {
                dropdown.classList.remove('active');
                const arrow = document.querySelector('.dropdown-arrow');
                if (arrow) {
                    arrow.style.transform = 'rotate(0deg)';
                }
            }
        });
    </script>
    {% block extra_scripts %}{% endblock %}
</body>
</html>
