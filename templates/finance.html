{% extends "base.html" %}

{% block title %}Finance Options - CarHub{% endblock %}

{% block extra_head %}
<style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Poppins:wght@300;400;600;700;900&display=swap');
    
    :root {
        --primary-purple: #7c4dff;
        --primary-blue: #23235b;
        --dark-blue: #181828;
        --darker-blue: #0a0a1a;
        --accent-cyan: #07b0b3;
        --light-purple: #a084ff;
        --text-light: #e0e6ff;
        --text-muted: #b3baff;
        --luxury-gold: #ffd700;
        --deep-space: #0a0a1a;
        --cosmic-purple: #7c4dff;
        --silver: #c0c0c0;
        --charcoal: #2E2E36;
        --premium-gold: #d4af37;
        --neon-blue: #00d4ff;
        --electric-purple: #8b5cf6;
        
        --gradient-primary: linear-gradient(90deg, #7c4dff 60%, #23235b 100%);
        --gradient-luxury: linear-gradient(90deg, #a084ff 80%, #23235b 100%);
        --gradient-dark: linear-gradient(120deg, #23235b 60%, #181828 100%);
        --gradient-space: radial-gradient(ellipse at top left, #23235b 0%, #0a0a1a 100%);
        --gradient-text: linear-gradient(45deg, #a084ff, #07b0b3, #ffd700);
        
        --dark-bg: #0a0a1a;
        --card-bg: rgba(255, 255, 255, 0.05);
        --border-color: rgba(124, 77, 255, 0.2);
    }

    * {
        box-sizing: border-box;
    }

    body {
        background: var(--gradient-space);
        color: var(--text-light);
        font-family: 'Poppins', 'Segoe UI', Arial, sans-serif;
        margin: 0;
        padding: 0;
        min-height: 100vh;
        overflow-x: hidden;
    }

    .finance-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 40px 20px;
        position: relative;
        z-index: 2;
    }

    .finance-header {
        text-align: center;
        margin-bottom: 50px;
    }

    .finance-title {
        font-family: 'Orbitron', monospace;
        font-size: 3rem;
        font-weight: 900;
        background: var(--gradient-text);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 20px;
        text-transform: uppercase;
        letter-spacing: 3px;
        animation: glow 2s ease-in-out infinite alternate;
    }

    @keyframes glow {
        from { filter: drop-shadow(0 0 10px rgba(124, 77, 255, 0.3)); }
        to { filter: drop-shadow(0 0 30px rgba(124, 77, 255, 0.7)); }
    }

    .selected-car {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 40px;
        backdrop-filter: blur(20px);
        box-shadow: 0 20px 60px rgba(124, 77, 255, 0.1);
    }

    .car-info {
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 30px;
        align-items: center;
    }

    .car-price {
        font-size: 2.5rem;
        font-weight: 900;
        color: var(--luxury-gold);
        text-align: center;
    }

    .car-details h3 {
        font-family: 'Orbitron', monospace;
        font-size: 1.8rem;
        color: var(--light-purple);
        margin-bottom: 15px;
    }

    .finance-options {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 30px;
        margin-bottom: 40px;
    }

    .finance-plan {
        background: var(--card-bg);
        border: 2px solid var(--border-color);
        border-radius: 20px;
        padding: 30px;
        backdrop-filter: blur(20px);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .finance-plan:hover {
        transform: translateY(-10px);
        border-color: var(--light-purple);
        box-shadow: 0 30px 80px rgba(124, 77, 255, 0.3);
    }

    .finance-plan.recommended {
        border-color: var(--luxury-gold);
        background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), var(--card-bg));
    }

    .plan-badge {
        position: absolute;
        top: 20px;
        right: 20px;
        background: var(--luxury-gold);
        color: var(--dark-blue);
        padding: 8px 16px;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: 700;
        text-transform: uppercase;
    }

    .plan-title {
        font-family: 'Orbitron', monospace;
        font-size: 1.5rem;
        color: var(--light-purple);
        margin-bottom: 20px;
        text-transform: uppercase;
    }

    .plan-details {
        margin-bottom: 25px;
    }

    .detail-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        padding: 10px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .detail-label {
        color: var(--text-muted);
    }

    .detail-value {
        color: var(--text-light);
        font-weight: 600;
    }

    .monthly-payment {
        font-size: 2rem;
        font-weight: 900;
        color: var(--luxury-gold);
        text-align: center;
        margin: 20px 0;
    }

    .select-plan-btn {
        width: 100%;
        padding: 15px;
        background: var(--gradient-primary);
        border: none;
        border-radius: 10px;
        color: white;
        font-size: 1rem;
        font-weight: 700;
        text-transform: uppercase;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'Orbitron', monospace;
        letter-spacing: 1px;
    }

    .select-plan-btn:hover {
        background: var(--gradient-luxury);
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(124, 77, 255, 0.4);
    }

    .finance-calculator {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 40px;
        backdrop-filter: blur(20px);
    }

    .calculator-title {
        font-family: 'Orbitron', monospace;
        font-size: 1.5rem;
        color: var(--light-purple);
        margin-bottom: 25px;
        text-align: center;
        text-transform: uppercase;
    }

    .calculator-form {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 25px;
    }

    .form-group {
        display: flex;
        flex-direction: column;
    }

    .form-label {
        color: var(--text-muted);
        margin-bottom: 8px;
        font-weight: 600;
    }

    .form-input {
        padding: 12px 15px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid var(--border-color);
        border-radius: 10px;
        color: var(--text-light);
        font-size: 1rem;
    }

    .form-input:focus {
        outline: none;
        border-color: var(--light-purple);
        box-shadow: 0 0 15px rgba(124, 77, 255, 0.3);
    }

    .calculate-btn {
        padding: 15px 30px;
        background: var(--gradient-primary);
        border: none;
        border-radius: 10px;
        color: white;
        font-size: 1rem;
        font-weight: 700;
        text-transform: uppercase;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'Orbitron', monospace;
    }

    .calculator-result {
        text-align: center;
        margin-top: 25px;
        padding: 20px;
        background: rgba(255, 215, 0, 0.1);
        border-radius: 15px;
        border: 1px solid var(--luxury-gold);
    }

    .result-payment {
        font-size: 2.5rem;
        font-weight: 900;
        color: var(--luxury-gold);
        margin-bottom: 10px;
    }

    .advantages {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 25px;
        margin-bottom: 40px;
    }

    .advantage-card {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 15px;
        padding: 25px;
        text-align: center;
        backdrop-filter: blur(20px);
        transition: all 0.3s ease;
    }

    .advantage-card:hover {
        transform: translateY(-5px);
        border-color: var(--light-purple);
    }

    .advantage-icon {
        font-size: 3rem;
        margin-bottom: 15px;
        display: block;
    }

    .advantage-title {
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--light-purple);
        margin-bottom: 10px;
    }

    .advantage-desc {
        color: var(--text-muted);
        line-height: 1.5;
    }

    .finance-form {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 20px;
        padding: 30px;
        backdrop-filter: blur(20px);
    }

    .form-title {
        font-family: 'Orbitron', monospace;
        font-size: 1.8rem;
        color: var(--light-purple);
        margin-bottom: 25px;
        text-align: center;
        text-transform: uppercase;
    }

    .form-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
    }

    .submit-btn {
        width: 100%;
        padding: 18px;
        background: var(--gradient-primary);
        border: none;
        border-radius: 10px;
        color: white;
        font-size: 1.2rem;
        font-weight: 700;
        text-transform: uppercase;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'Orbitron', monospace;
        letter-spacing: 2px;
        margin-top: 20px;
    }

    .submit-btn:hover {
        background: var(--gradient-luxury);
        transform: translateY(-3px);
        box-shadow: 0 15px 40px rgba(124, 77, 255, 0.4);
    }

    @media (max-width: 768px) {
        .finance-title {
            font-size: 2rem;
        }
        
        .car-info {
            grid-template-columns: 1fr;
            text-align: center;
        }
        
        .finance-options {
            grid-template-columns: 1fr;
        }
        
        .calculator-form {
            grid-template-columns: 1fr;
        }
        
        .advantages {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="finance-container">
    <div class="finance-header">
        <h1 class="finance-title">Finance Your Dream Car</h1>
        <p class="text-muted">Flexible financing options tailored to your needs</p>
    </div>

    <!-- Selected Car Information -->
    <div class="selected-car">
        <div class="car-info">
            <div class="car-price">{{ car_price or '$0' }}</div>
            <div class="car-details">
                <h3>{{ car_name or 'Selected Vehicle' }}</h3>
                <p class="text-muted">Premium luxury vehicle with exceptional performance and comfort</p>
            </div>
        </div>
    </div>

    <!-- Finance Options -->
    <div class="finance-options">
        <div class="finance-plan">
            <div class="plan-title">Standard Plan</div>
            <div class="plan-details">
                <div class="detail-row">
                    <span class="detail-label">Term Length</span>
                    <span class="detail-value">60 months</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Interest Rate</span>
                    <span class="detail-value">4.9% APR</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Down Payment</span>
                    <span class="detail-value">15%</span>
                </div>
            </div>
            <div class="monthly-payment">$899/mo</div>
            <button class="select-plan-btn" onclick="selectPlan('standard')">Select Plan</button>
        </div>

        <div class="finance-plan recommended">
            <div class="plan-badge">Recommended</div>
            <div class="plan-title">Premium Plan</div>
            <div class="plan-details">
                <div class="detail-row">
                    <span class="detail-label">Term Length</span>
                    <span class="detail-value">48 months</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Interest Rate</span>
                    <span class="detail-value">3.9% APR</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Down Payment</span>
                    <span class="detail-value">20%</span>
                </div>
            </div>
            <div class="monthly-payment">$1,099/mo</div>
            <button class="select-plan-btn" onclick="selectPlan('premium')">Select Plan</button>
        </div>

        <div class="finance-plan">
            <div class="plan-title">Extended Plan</div>
            <div class="plan-details">
                <div class="detail-row">
                    <span class="detail-label">Term Length</span>
                    <span class="detail-value">72 months</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Interest Rate</span>
                    <span class="detail-value">5.9% APR</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Down Payment</span>
                    <span class="detail-value">10%</span>
                </div>
            </div>
            <div class="monthly-payment">$749/mo</div>
            <button class="select-plan-btn" onclick="selectPlan('extended')">Select Plan</button>
        </div>
    </div>

    <!-- Finance Calculator -->
    <div class="finance-calculator">
        <h2 class="calculator-title">Custom Payment Calculator</h2>
        <div class="calculator-form">
            <div class="form-group">
                <label class="form-label">Vehicle Price</label>
                <input type="number" class="form-input" id="vehiclePrice" value="{{ car_price_numeric or 50000 }}">
            </div>
            <div class="form-group">
                <label class="form-label">Down Payment</label>
                <input type="number" class="form-input" id="downPayment" value="10000">
            </div>
            <div class="form-group">
                <label class="form-label">Interest Rate (%)</label>
                <input type="number" class="form-input" id="interestRate" value="4.9" step="0.1">
            </div>
            <div class="form-group">
                <label class="form-label">Loan Term (months)</label>
                <input type="number" class="form-input" id="loanTerm" value="60">
            </div>
        </div>
        <button class="calculate-btn" onclick="calculatePayment()">Calculate Payment</button>
        <div class="calculator-result" id="calculatorResult" style="display: none;">
            <div class="result-payment" id="monthlyPayment">$0</div>
            <p class="text-muted">Estimated Monthly Payment</p>
        </div>
    </div>

    <!-- Advantages -->
    <div class="advantages">
        <div class="advantage-card">
            <div class="advantage-icon">💰</div>
            <div class="advantage-title">Competitive Rates</div>
            <div class="advantage-desc">Get the best financing rates in the market with our trusted partners</div>
        </div>
        <div class="advantage-card">
            <div class="advantage-icon">⚡</div>
            <div class="advantage-title">Quick Approval</div>
            <div class="advantage-desc">Fast approval process with decisions in as little as 15 minutes</div>
        </div>
        <div class="advantage-card">
            <div class="advantage-icon">🛡️</div>
            <div class="advantage-title">Flexible Terms</div>
            <div class="advantage-desc">Choose from various term lengths and payment options that fit your budget</div>
        </div>
        <div class="advantage-card">
            <div class="advantage-icon">📱</div>
            <div class="advantage-title">Easy Management</div>
            <div class="advantage-desc">Manage your payments online with our user-friendly portal</div>
        </div>
    </div>

    <!-- Finance Application Form -->
    <div class="finance-form" id="financeForm" style="display: none;">
        <h2 class="form-title">Finance Application</h2>
        <form method="POST">
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" class="form-input" name="full_name" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" name="email" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Phone Number</label>
                    <input type="tel" class="form-input" name="phone" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Annual Income</label>
                    <input type="number" class="form-input" name="annual_income" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Employment Status</label>
                    <select class="form-input" name="employment_status" required>
                        <option value="">Select Status</option>
                        <option value="employed">Employed</option>
                        <option value="self_employed">Self Employed</option>
                        <option value="retired">Retired</option>
                        <option value="student">Student</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Credit Score Range</label>
                    <select class="form-input" name="credit_score">
                        <option value="">Select Range</option>
                        <option value="excellent">750+ (Excellent)</option>
                        <option value="good">700-749 (Good)</option>
                        <option value="fair">650-699 (Fair)</option>
                        <option value="poor">Below 650 (Poor)</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Address</label>
                <input type="text" class="form-input" name="address" required>
            </div>
            <input type="hidden" name="selected_plan" id="selectedPlan" value="">
            <input type="hidden" name="car_id" value="{{ car_id }}">
            <input type="hidden" name="car_name" value="{{ car_name }}">
            <input type="hidden" name="car_price" value="{{ car_price }}">
            <button type="submit" class="submit-btn">Submit Application</button>
        </form>
    </div>
</div>

<script>
let selectedFinancePlan = '';

function selectPlan(planType) {
    selectedFinancePlan = planType;
    document.getElementById('selectedPlan').value = planType;
    
    // Show the form
    document.getElementById('financeForm').style.display = 'block';
    document.getElementById('financeForm').scrollIntoView({ behavior: 'smooth' });
    
    // Update all buttons to show selection
    document.querySelectorAll('.select-plan-btn').forEach(btn => {
        btn.textContent = 'SELECT PLAN';
        btn.style.background = 'var(--gradient-primary)';
    });
    
    // Highlight selected button
    event.target.textContent = 'SELECTED ✓';
    event.target.style.background = 'var(--gradient-luxury)';
}

function calculatePayment() {
    const vehiclePrice = parseFloat(document.getElementById('vehiclePrice').value) || 0;
    const downPayment = parseFloat(document.getElementById('downPayment').value) || 0;
    const annualRate = parseFloat(document.getElementById('interestRate').value) || 0;
    const loanTermMonths = parseFloat(document.getElementById('loanTerm').value) || 0;
    
    const principal = vehiclePrice - downPayment;
    const monthlyRate = annualRate / 100 / 12;
    
    if (principal <= 0 || loanTermMonths <= 0) {
        alert('Please enter valid values');
        return;
    }
    
    let monthlyPayment;
    if (monthlyRate === 0) {
        monthlyPayment = principal / loanTermMonths;
    } else {
        monthlyPayment = principal * (monthlyRate * Math.pow(1 + monthlyRate, loanTermMonths)) / (Math.pow(1 + monthlyRate, loanTermMonths) - 1);
    }
    
    document.getElementById('monthlyPayment').textContent = '$' + Math.round(monthlyPayment).toLocaleString();
    document.getElementById('calculatorResult').style.display = 'block';
    document.getElementById('calculatorResult').scrollIntoView({ behavior: 'smooth' });
}

// Pre-fill calculator with car price if available
window.addEventListener('load', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const carPrice = urlParams.get('price');
    if (carPrice) {
        // Remove currency symbols and convert to number
        const numericPrice = parseFloat(carPrice.replace(/[^0-9.]/g, ''));
        if (!isNaN(numericPrice)) {
            document.getElementById('vehiclePrice').value = numericPrice;
        }
    }
});
</script>
{% endblock %}
